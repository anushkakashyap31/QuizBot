<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 1560" width="1280" height="1560" font-family="Arial, sans-serif">
  <rect width="1280" height="1560" fill="#ffffff"/>
  <rect width="1280" height="1560" fill="none" stroke="#d1d5db" stroke-width="1.5"/>

  <!-- TITLE -->
  <rect x="0" y="0" width="1280" height="50" fill="#1e3a5f"/>
  <text x="640" y="32" text-anchor="middle" font-size="16" font-weight="bold" fill="#ffffff">QuizBot â€” Module Interaction Diagram</text>
  <text x="640" y="46" text-anchor="middle" font-size="9" fill="#93c5fd">5.1 Frontend â†” Backend  Â·  5.2 Backend â†” AI  Â·  5.3 Backend â†” Database  Â·  5.4 External Services</text>

  <defs>
    <marker id="mb"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#1d4ed8"/></marker>
    <marker id="mg"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#15803d"/></marker>
    <marker id="mr"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#dc2626"/></marker>
    <marker id="mo"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#b45309"/></marker>
    <marker id="mp"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#7c3aed"/></marker>
    <marker id="mk"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#059669"/></marker>
    <marker id="mt"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#d97706"/></marker>
    <marker id="mc"  markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#c2410c"/></marker>
  </defs>

  <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
  <!-- â•‘  5.1  FRONTEND â†” BACKEND                                   â•‘ -->
  <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <rect x="10" y="62" width="1260" height="26" rx="5" fill="#1e3a5f"/>
  <text x="640" y="80" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">5.1   Interaction Between Frontend and Backend</text>

  <!-- â”€â”€ FRONTEND MODULE BOX â”€â”€ -->
  <rect x="18" y="100" width="300" height="276" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
  <rect x="18" y="100" width="300" height="34" rx="8" fill="#3b82f6"/>
  <rect x="18" y="122" width="300" height="12" fill="#3b82f6"/>
  <text x="168" y="122" text-anchor="middle" font-size="12" font-weight="bold" fill="#ffffff">ğŸ–¥ï¸ React Frontend</text>

  <!-- sub-modules, two columns -->
  <rect x="28" y="142" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="95" y="157" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">LoginPage / RegisterPage</text>
  <rect x="28" y="170" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="95" y="185" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">GeneratePage</text>
  <rect x="28" y="198" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="95" y="213" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">QuizInterface</text>
  <rect x="28" y="226" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="95" y="241" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">ResultCard</text>
  <rect x="28" y="254" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="95" y="269" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">ProgressDashboard</text>

  <rect x="172" y="142" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="239" y="157" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">Zustand authStore</text>
  <rect x="172" y="170" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="239" y="185" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">Zustand quizStore</text>
  <rect x="172" y="198" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="239" y="213" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">Axios HTTP Client</text>
  <rect x="172" y="226" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="239" y="241" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">React Router v6</text>
  <rect x="172" y="254" width="134" height="22" rx="4" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="239" y="269" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#1e40af">Framer Motion</text>

  <!-- â”€â”€ CHANNEL â”€â”€ -->
  <rect x="330" y="100" width="468" height="276" rx="8" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1.5"/>
  <text x="564" y="124" text-anchor="middle" font-size="9.5" font-weight="bold" fill="#374151">Communication Channel â€” REST over HTTPS</text>
  <rect x="340" y="130" width="448" height="16" rx="4" fill="#f1f5f9"/>
  <text x="564" y="142" text-anchor="middle" font-size="8" fill="#374151">Auth: Authorization: Bearer &lt;JWT&gt;  Â·  Format: application/json  Â·  CORS: localhost:5173 only</text>

  <!-- calls + responses -->
  <!-- row 1 -->
  <line x1="318" y1="162" x2="340" y2="162" stroke="#1d4ed8" stroke-width="1.4" marker-end="url(#mb)"/>
  <rect x="346" y="154" width="222" height="16" rx="3" fill="#dbeafe"/>
  <text x="457" y="166" text-anchor="middle" font-size="8" fill="#1e40af">POST /api/auth/login  { firebase_token }</text>
  <line x1="572" y1="162" x2="770" y2="162" stroke="#15803d" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mg)"/>
  <rect x="576" y="154" width="190" height="16" rx="3" fill="#dcfce7"/>
  <text x="671" y="166" text-anchor="middle" font-size="8" fill="#15803d">{ jwt_token, user_id, email }</text>

  <!-- row 2 -->
  <line x1="318" y1="190" x2="340" y2="190" stroke="#1d4ed8" stroke-width="1.4" marker-end="url(#mb)"/>
  <rect x="346" y="182" width="222" height="16" rx="3" fill="#dbeafe"/>
  <text x="457" y="194" text-anchor="middle" font-size="8" fill="#1e40af">POST /api/auth/register  { token, name }</text>
  <line x1="572" y1="190" x2="770" y2="190" stroke="#15803d" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mg)"/>
  <rect x="576" y="182" width="190" height="16" rx="3" fill="#dcfce7"/>
  <text x="671" y="194" text-anchor="middle" font-size="8" fill="#15803d">{ jwt_token, user_id }</text>

  <!-- row 3 -->
  <line x1="318" y1="218" x2="340" y2="218" stroke="#1d4ed8" stroke-width="1.4" marker-end="url(#mb)"/>
  <rect x="346" y="210" width="222" height="16" rx="3" fill="#dbeafe"/>
  <text x="457" y="222" text-anchor="middle" font-size="8" fill="#1e40af">POST /api/quiz/generate  { email_text, n }</text>
  <line x1="572" y1="218" x2="770" y2="218" stroke="#15803d" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mg)"/>
  <rect x="576" y="210" width="190" height="16" rx="3" fill="#dcfce7"/>
  <text x="671" y="222" text-anchor="middle" font-size="8" fill="#15803d">{ quiz_id, questions[ ] }</text>

  <!-- row 4 -->
  <line x1="318" y1="246" x2="340" y2="246" stroke="#1d4ed8" stroke-width="1.4" marker-end="url(#mb)"/>
  <rect x="346" y="238" width="222" height="16" rx="3" fill="#dbeafe"/>
  <text x="457" y="250" text-anchor="middle" font-size="8" fill="#1e40af">POST /api/quiz/evaluate  { answers[ ] }</text>
  <line x1="572" y1="246" x2="770" y2="246" stroke="#15803d" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mg)"/>
  <rect x="576" y="238" width="190" height="16" rx="3" fill="#dcfce7"/>
  <text x="671" y="250" text-anchor="middle" font-size="8" fill="#15803d">{ score, results[ ], summary }</text>

  <!-- row 5 -->
  <line x1="318" y1="274" x2="340" y2="274" stroke="#1d4ed8" stroke-width="1.4" marker-end="url(#mb)"/>
  <rect x="346" y="266" width="222" height="16" rx="3" fill="#dbeafe"/>
  <text x="457" y="278" text-anchor="middle" font-size="8" fill="#1e40af">GET  /api/analytics/user/{uid}</text>
  <line x1="572" y1="274" x2="770" y2="274" stroke="#15803d" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mg)"/>
  <rect x="576" y="266" width="190" height="16" rx="3" fill="#dcfce7"/>
  <text x="671" y="278" text-anchor="middle" font-size="8" fill="#15803d">{ accuracy, attempts, history[ ] }</text>

  <!-- middleware row -->
  <rect x="340" y="292" width="448" height="74" rx="5" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="564" y="310" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#374151">Security Middleware Stack (applied in order on every request):</text>
  <rect x="350" y="316" width="96" height="18" rx="4" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
  <text x="398" y="329" text-anchor="middle" font-size="8" fill="#92400e">â‘  JWT Validate</text>
  <text x="455" y="329" font-size="12" fill="#94a3b8">â†’</text>
  <rect x="466" y="316" width="96" height="18" rx="4" fill="#f3e8ff" stroke="#9333ea" stroke-width="1"/>
  <text x="514" y="329" text-anchor="middle" font-size="8" fill="#6d28d9">â‘¡ CORS Check</text>
  <text x="571" y="329" font-size="12" fill="#94a3b8">â†’</text>
  <rect x="582" y="316" width="96" height="18" rx="4" fill="#dcfce7" stroke="#16a34a" stroke-width="1"/>
  <text x="630" y="329" text-anchor="middle" font-size="8" fill="#15803d">â‘¢ Input Validate</text>
  <text x="687" y="329" font-size="12" fill="#94a3b8">â†’</text>
  <rect x="698" y="316" width="82" height="18" rx="4" fill="#fee2e2" stroke="#dc2626" stroke-width="1"/>
  <text x="739" y="329" text-anchor="middle" font-size="8" fill="#991b1b">â‘£ Sanitize Err</text>
  <text x="350" y="356" font-size="7.5" fill="#6b7280">Any failure at â‘ â€“â‘£ returns HTTP 401 / 422 immediately â€” request never reaches route handler</text>

  <!-- â”€â”€ BACKEND MODULE BOX â”€â”€ -->
  <rect x="810" y="100" width="300" height="276" rx="8" fill="#fefce8" stroke="#ca8a04" stroke-width="2"/>
  <rect x="810" y="100" width="300" height="34" rx="8" fill="#ca8a04"/>
  <rect x="810" y="122" width="300" height="12" fill="#ca8a04"/>
  <text x="960" y="122" text-anchor="middle" font-size="12" font-weight="bold" fill="#ffffff">âš™ï¸ FastAPI Backend</text>

  <rect x="820" y="142" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="887" y="157" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">auth_routes.py</text>
  <rect x="820" y="170" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="887" y="185" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">quiz_routes.py</text>
  <rect x="820" y="198" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="887" y="213" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">analytics_routes.py</text>
  <rect x="820" y="226" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="887" y="241" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">auth_service.py</text>
  <rect x="820" y="254" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="887" y="269" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">quiz_generator.py</text>

  <rect x="964" y="142" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="1031" y="157" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">JWT Middleware</text>
  <rect x="964" y="170" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="1031" y="185" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">CORS Middleware</text>
  <rect x="964" y="198" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="1031" y="213" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">Pydantic Schemas</text>
  <rect x="964" y="226" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="1031" y="241" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">llm_service.py</text>
  <rect x="964" y="254" width="134" height="22" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="1031" y="269" text-anchor="middle" font-size="8.5" font-weight="bold" fill="#92400e">Error Sanitizer</text>

  <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
  <!-- â•‘  5.2  BACKEND â†” AI MODULE                                  â•‘ -->
  <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <rect x="10" y="394" width="1260" height="26" rx="5" fill="#047857"/>
  <text x="640" y="412" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">5.2   Interaction Between Backend and AI Module</text>

  <!-- Backend (left ref) -->
  <rect x="18" y="432" width="240" height="246" rx="8" fill="#fefce8" stroke="#ca8a04" stroke-width="2"/>
  <rect x="18" y="432" width="240" height="34" rx="8" fill="#ca8a04"/>
  <rect x="18" y="454" width="240" height="12" fill="#ca8a04"/>
  <text x="138" y="454" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">âš™ï¸ Backend Services</text>
  <rect x="28" y="470" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="484" text-anchor="middle" font-size="8" fill="#92400e">quiz_generator.py</text>
  <rect x="28" y="496" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="510" text-anchor="middle" font-size="8" fill="#92400e">llm_service.py  (Gemini client singleton)</text>
  <rect x="28" y="522" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="536" text-anchor="middle" font-size="8" fill="#92400e">vector_db.py  (ChromaDB client singleton)</text>
  <rect x="28" y="548" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="562" text-anchor="middle" font-size="8" fill="#92400e">embedding_service.py  (MiniLM encoder)</text>
  <rect x="28" y="574" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="588" text-anchor="middle" font-size="8" fill="#92400e">retry_handler.py  (exp. backoff)</text>
  <rect x="28" y="600" width="220" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="138" y="614" text-anchor="middle" font-size="8" fill="#92400e">json_validator.py  (AI output check)</text>

  <!-- AI interactions panel -->
  <rect x="272" y="432" width="614" height="246" rx="8" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1.5"/>
  <text x="579" y="454" text-anchor="middle" font-size="9.5" font-weight="bold" fill="#374151">AI Module Calls</text>
  <line x1="284" y1="460" x2="874" y2="460" stroke="#e5e7eb" stroke-width="1"/>

  <!-- Gemini header -->
  <rect x="284" y="464" width="76" height="16" rx="4" fill="#ecfdf5" stroke="#a7f3d0" stroke-width="1"/>
  <text x="322" y="476" text-anchor="middle" font-size="8" font-weight="bold" fill="#047857">Gemini API</text>

  <line x1="258" y1="492" x2="284" y2="492" stroke="#059669" stroke-width="1.4" marker-end="url(#mk)"/>
  <rect x="290" y="484" width="280" height="16" rx="3" fill="#ecfdf5"/>
  <text x="430" y="496" text-anchor="middle" font-size="7.5" fill="#047857">Quiz Gen: generate_content("Generate N MCQs from email. Return JSON.")</text>
  <line x1="574" y1="492" x2="760" y2="492" stroke="#059669" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mk)"/>
  <rect x="568" y="484" width="194" height="16" rx="3" fill="#ecfdf5"/>
  <text x="763" y="495" text-anchor="middle" font-size="7.5" fill="#047857">{ quiz_id, questions[ ] }</text>

  <line x1="258" y1="516" x2="284" y2="516" stroke="#059669" stroke-width="1.4" marker-end="url(#mk)"/>
  <rect x="290" y="508" width="280" height="16" rx="3" fill="#ecfdf5"/>
  <text x="430" y="520" text-anchor="middle" font-size="7.5" fill="#047857">Evaluate: generate_content("Is answer X correct? Explain.")</text>
  <line x1="574" y1="516" x2="760" y2="516" stroke="#059669" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mk)"/>
  <rect x="568" y="508" width="194" height="16" rx="3" fill="#ecfdf5"/>
  <text x="763" y="519" text-anchor="middle" font-size="7.5" fill="#047857">{ is_correct, explanation }</text>

  <line x1="258" y1="540" x2="284" y2="540" stroke="#059669" stroke-width="1.4" marker-end="url(#mk)"/>
  <rect x="290" y="532" width="280" height="16" rx="3" fill="#ecfdf5"/>
  <text x="430" y="544" text-anchor="middle" font-size="7.5" fill="#047857">Summary: generate_content("Summarise user performance.")</text>
  <line x1="574" y1="540" x2="760" y2="540" stroke="#059669" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mk)"/>
  <rect x="568" y="532" width="194" height="16" rx="3" fill="#ecfdf5"/>
  <text x="763" y="543" text-anchor="middle" font-size="7.5" fill="#047857">{ summary_text }</text>

  <!-- ChromaDB header -->
  <rect x="284" y="554" width="76" height="16" rx="4" fill="#fff7ed" stroke="#fed7aa" stroke-width="1"/>
  <text x="322" y="566" text-anchor="middle" font-size="8" font-weight="bold" fill="#c2410c">ChromaDB</text>

  <line x1="258" y1="580" x2="284" y2="580" stroke="#c2410c" stroke-width="1.4" marker-end="url(#mc)"/>
  <rect x="290" y="572" width="280" height="16" rx="3" fill="#fff7ed"/>
  <text x="430" y="584" text-anchor="middle" font-size="7.5" fill="#c2410c">collection.add(documents, embeddings, ids) â€” store email vector</text>
  <line x1="574" y1="580" x2="760" y2="580" stroke="#c2410c" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mc)"/>
  <rect x="568" y="572" width="194" height="16" rx="3" fill="#fff7ed"/>
  <text x="763" y="583" text-anchor="middle" font-size="7.5" fill="#c2410c">{ chroma_doc_id }</text>

  <line x1="258" y1="604" x2="284" y2="604" stroke="#c2410c" stroke-width="1.4" marker-end="url(#mc)"/>
  <rect x="290" y="596" width="280" height="16" rx="3" fill="#fff7ed"/>
  <text x="430" y="608" text-anchor="middle" font-size="7.5" fill="#c2410c">collection.query(query_embeddings, n_results=5)</text>
  <line x1="574" y1="604" x2="760" y2="604" stroke="#c2410c" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mc)"/>
  <rect x="568" y="596" width="194" height="16" rx="3" fill="#fff7ed"/>
  <text x="763" y="607" text-anchor="middle" font-size="7.5" fill="#c2410c">{ documents, distances }</text>

  <!-- reliability note -->
  <rect x="284" y="624" width="578" height="44" rx="5" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
  <text x="573" y="641" text-anchor="middle" font-size="8" fill="#374151">Reliability: Exponential backoff â€” 5 attempts max, wait = 2^n seconds + random jitter â€” fallback response on all-fail</text>
  <text x="573" y="657" text-anchor="middle" font-size="7.5" fill="#6b7280">Gemini model: gemini-1.5-flash  Â·  Embedding: all-MiniLM-L6-v2 (384-dim)  Â·  ChromaDB: in-process client (no network port)</text>

  <!-- AI Module box (right) -->
  <rect x="898" y="432" width="250" height="246" rx="8" fill="#ecfdf5" stroke="#059669" stroke-width="2"/>
  <rect x="898" y="432" width="250" height="34" rx="8" fill="#059669"/>
  <rect x="898" y="454" width="250" height="12" fill="#059669"/>
  <text x="1023" y="454" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">ğŸ¤– AI / ML Layer</text>
  <rect x="908" y="470" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="484" text-anchor="middle" font-size="8" fill="#047857">Google Gemini 1.5 Flash</text>
  <rect x="908" y="496" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="510" text-anchor="middle" font-size="8" fill="#047857">ChromaDB Vector Store</text>
  <rect x="908" y="522" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="536" text-anchor="middle" font-size="8" fill="#047857">Sentence Transformers (MiniLM-L6-v2)</text>
  <rect x="908" y="548" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="562" text-anchor="middle" font-size="8" fill="#047857">HNSW Index (cosine similarity)</text>
  <rect x="908" y="574" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="588" text-anchor="middle" font-size="8" fill="#047857">JSON Schema Validator</text>
  <rect x="908" y="600" width="230" height="20" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="1023" y="614" text-anchor="middle" font-size="8" fill="#047857">Retry Handler (python tenacity)</text>

  <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
  <!-- â•‘  5.3  BACKEND â†” DATABASE                                   â•‘ -->
  <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <rect x="10" y="694" width="1260" height="26" rx="5" fill="#5b21b6"/>
  <text x="640" y="712" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">5.3   Interaction Between Backend and Database</text>

  <!-- Backend ref left -->
  <rect x="18" y="732" width="210" height="272" rx="8" fill="#fefce8" stroke="#ca8a04" stroke-width="2"/>
  <rect x="18" y="732" width="210" height="34" rx="8" fill="#ca8a04"/>
  <rect x="18" y="754" width="210" height="12" fill="#ca8a04"/>
  <text x="123" y="754" text-anchor="middle" font-size="10" font-weight="bold" fill="#ffffff">âš™ï¸ Backend Layer</text>
  <rect x="28" y="770" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="784" text-anchor="middle" font-size="8" fill="#92400e">database.py (SessionLocal)</text>
  <rect x="28" y="796" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="810" text-anchor="middle" font-size="8" fill="#92400e">models.py (ORM table definitions)</text>
  <rect x="28" y="822" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="836" text-anchor="middle" font-size="8" fill="#92400e">auth_service.py</text>
  <rect x="28" y="848" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="862" text-anchor="middle" font-size="8" fill="#92400e">quiz_generator.py</text>
  <rect x="28" y="874" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="888" text-anchor="middle" font-size="8" fill="#92400e">analytics_routes.py</text>
  <rect x="28" y="900" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="914" text-anchor="middle" font-size="8" fill="#92400e">firebase_admin (DB writes)</text>
  <rect x="28" y="926" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="940" text-anchor="middle" font-size="8" fill="#92400e">Pydantic models â†’ ORM objects</text>
  <rect x="28" y="952" width="190" height="20" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="123" y="966" text-anchor="middle" font-size="8" fill="#92400e">Connection pool (SQLAlchemy)</text>

  <!-- DB ops panel -->
  <rect x="242" y="732" width="684" height="272" rx="8" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1.5"/>
  <text x="584" y="754" text-anchor="middle" font-size="9.5" font-weight="bold" fill="#374151">Database Operations (SQLite via SQLAlchemy ORM + Firebase Admin SDK)</text>
  <line x1="252" y1="760" x2="916" y2="760" stroke="#e5e7eb" stroke-width="1"/>

  <!-- SQLite label -->
  <rect x="252" y="764" width="62" height="16" rx="4" fill="#f5f3ff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="283" y="776" text-anchor="middle" font-size="8" font-weight="bold" fill="#6d28d9">SQLite</text>

  <!-- op rows -->
  <line x1="228" y1="792" x2="252" y2="792" stroke="#7c3aed" stroke-width="1.4" marker-end="url(#mp)"/>
  <rect x="258" y="784" width="344" height="16" rx="3" fill="#f5f3ff"/>
  <text x="430" y="796" text-anchor="middle" font-size="7.5" fill="#6d28d9">INSERT INTO users (uid, email, full_name)  â€” Registration</text>
  <line x1="606" y1="792" x2="720" y2="792" stroke="#7c3aed" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mp)"/>
  <rect x="604" y="784" width="116" height="16" rx="3" fill="#f5f3ff"/>
  <text x="714" y="796" text-anchor="middle" font-size="7.5" fill="#6d28d9">user_id â†’ OK</text>

  <line x1="228" y1="816" x2="252" y2="816" stroke="#7c3aed" stroke-width="1.4" marker-end="url(#mp)"/>
  <rect x="258" y="808" width="344" height="16" rx="3" fill="#f5f3ff"/>
  <text x="430" y="820" text-anchor="middle" font-size="7.5" fill="#6d28d9">INSERT INTO quizzes + questions  â€” Quiz saved</text>
  <line x1="606" y1="816" x2="720" y2="816" stroke="#7c3aed" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mp)"/>
  <rect x="604" y="808" width="116" height="16" rx="3" fill="#f5f3ff"/>
  <text x="714" y="820" text-anchor="middle" font-size="7.5" fill="#6d28d9">quiz_id confirmed</text>

  <line x1="228" y1="840" x2="252" y2="840" stroke="#7c3aed" stroke-width="1.4" marker-end="url(#mp)"/>
  <rect x="258" y="832" width="344" height="16" rx="3" fill="#f5f3ff"/>
  <text x="430" y="844" text-anchor="middle" font-size="7.5" fill="#6d28d9">INSERT INTO quiz_results + question_results  â€” Evaluation</text>
  <line x1="606" y1="840" x2="720" y2="840" stroke="#7c3aed" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mp)"/>
  <rect x="604" y="832" width="116" height="16" rx="3" fill="#f5f3ff"/>
  <text x="714" y="844" text-anchor="middle" font-size="7.5" fill="#6d28d9">result_id confirmed</text>

  <line x1="228" y1="864" x2="252" y2="864" stroke="#7c3aed" stroke-width="1.4" marker-end="url(#mp)"/>
  <rect x="258" y="856" width="344" height="16" rx="3" fill="#f5f3ff"/>
  <text x="430" y="868" text-anchor="middle" font-size="7.5" fill="#6d28d9">UPDATE user_progress SET accuracy, total_attempts</text>
  <line x1="606" y1="864" x2="720" y2="864" stroke="#7c3aed" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mp)"/>
  <rect x="604" y="856" width="116" height="16" rx="3" fill="#f5f3ff"/>
  <text x="714" y="868" text-anchor="middle" font-size="7.5" fill="#6d28d9">progress updated</text>

  <line x1="228" y1="888" x2="252" y2="888" stroke="#7c3aed" stroke-width="1.4" marker-end="url(#mp)"/>
  <rect x="258" y="880" width="344" height="16" rx="3" fill="#f5f3ff"/>
  <text x="430" y="892" text-anchor="middle" font-size="7.5" fill="#6d28d9">SELECT * FROM quiz_results WHERE user_id = ?  â€” Analytics</text>
  <line x1="606" y1="888" x2="720" y2="888" stroke="#7c3aed" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mp)"/>
  <rect x="604" y="880" width="116" height="16" rx="3" fill="#f5f3ff"/>
  <text x="714" y="892" text-anchor="middle" font-size="7.5" fill="#6d28d9">results[ ]</text>

  <!-- Firebase DB label -->
  <rect x="252" y="904" width="76" height="16" rx="4" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
  <text x="290" y="916" text-anchor="middle" font-size="8" font-weight="bold" fill="#92400e">Firebase DB</text>

  <line x1="228" y1="930" x2="252" y2="930" stroke="#d97706" stroke-width="1.4" marker-end="url(#mt)"/>
  <rect x="258" y="922" width="344" height="16" rx="3" fill="#fef3c7"/>
  <text x="430" y="934" text-anchor="middle" font-size="7.5" fill="#92400e">db.reference("quiz_history/{uid}/{quiz_id}").set({ score, results })</text>
  <line x1="606" y1="930" x2="720" y2="930" stroke="#d97706" stroke-width="1.2" stroke-dasharray="4,3" marker-end="url(#mt)"/>
  <rect x="604" y="922" width="116" height="16" rx="3" fill="#fef3c7"/>
  <text x="714" y="934" text-anchor="middle" font-size="7.5" fill="#92400e">write confirmed</text>

  <rect x="252" y="952" width="668" height="44" rx="5" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
  <text x="586" y="969" text-anchor="middle" font-size="8" fill="#374151">ORM: SQLAlchemy 2.0 async sessions  Â·  Indexes on: user_id, quiz_id, completed_at  Â·  Parameterised queries (SQL injection safe)</text>
  <text x="586" y="984" text-anchor="middle" font-size="7.5" fill="#6b7280">Firebase: firebase_admin.db.reference().set()  Â·  Path: quiz_history/{uid}/{quiz_id}  Â·  Security Rules: deny all direct client access</text>

  <!-- DB layer box right -->
  <rect x="940" y="732" width="210" height="272" rx="8" fill="#f5f3ff" stroke="#7c3aed" stroke-width="2"/>
  <rect x="940" y="732" width="210" height="34" rx="8" fill="#7c3aed"/>
  <rect x="940" y="754" width="210" height="12" fill="#7c3aed"/>
  <text x="1045" y="754" text-anchor="middle" font-size="10" font-weight="bold" fill="#ffffff">ğŸ—ƒï¸ Data Layer</text>
  <rect x="950" y="770" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="784" text-anchor="middle" font-size="8" fill="#6d28d9">SQLite â€” users</text>
  <rect x="950" y="796" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="810" text-anchor="middle" font-size="8" fill="#6d28d9">SQLite â€” quizzes + questions</text>
  <rect x="950" y="822" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="836" text-anchor="middle" font-size="8" fill="#6d28d9">SQLite â€” quiz_results</text>
  <rect x="950" y="848" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="862" text-anchor="middle" font-size="8" fill="#6d28d9">SQLite â€” question_results</text>
  <rect x="950" y="874" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="888" text-anchor="middle" font-size="8" fill="#6d28d9">SQLite â€” user_progress</text>
  <rect x="950" y="900" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="914" text-anchor="middle" font-size="8" fill="#6d28d9">Firebase Realtime DB (quiz_history)</text>
  <rect x="950" y="926" width="190" height="20" rx="4" fill="#ffffff" stroke="#ddd6fe" stroke-width="1"/>
  <text x="1045" y="940" text-anchor="middle" font-size="8" fill="#6d28d9">ChromaDB â€” donor_emails</text>

  <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
  <!-- â•‘  5.4  EXTERNAL SERVICES                                     â•‘ -->
  <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <rect x="10" y="1022" width="1260" height="26" rx="5" fill="#b45309"/>
  <text x="640" y="1040" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">5.4   Interaction with External Services</text>

  <!-- 4 service cards in a row -->

  <!-- Firebase Auth -->
  <rect x="18" y="1062" width="296" height="316" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
  <rect x="18" y="1062" width="296" height="34" rx="8" fill="#dc2626"/>
  <rect x="18" y="1084" width="296" height="12" fill="#dc2626"/>
  <text x="166" y="1084" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">ğŸ”¥ Firebase Auth</text>
  <rect x="28" y="1098" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1111" text-anchor="middle" font-size="8" fill="#374151">Protocol: HTTPS REST + Firebase Admin SDK</text>
  <rect x="28" y="1122" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1135" text-anchor="middle" font-size="8" fill="#374151">Auth: Service Account JSON  (stored in .env)</text>
  <rect x="28" y="1146" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1159" text-anchor="middle" font-size="8" fill="#374151">Call: auth.verify_id_token(id_token)</text>
  <rect x="28" y="1170" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1183" text-anchor="middle" font-size="8" fill="#374151">Call: auth.create_user(email, password)</text>
  <rect x="28" y="1194" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="166" y="1207" text-anchor="middle" font-size="8" fill="#92400e">Returns: { uid, email, token_claims }</text>
  <rect x="28" y="1218" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="166" y="1231" text-anchor="middle" font-size="8" fill="#92400e">Token expiry: 1 hour â€” silent refresh via SDK</text>
  <rect x="28" y="1242" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1255" text-anchor="middle" font-size="8" fill="#374151">Purpose: Identity verification â€” no passwords stored</text>
  <rect x="28" y="1266" width="276" height="18" rx="4" fill="#ffffff" stroke="#fecaca" stroke-width="1"/>
  <text x="166" y="1279" text-anchor="middle" font-size="8" fill="#374151">Client SDK: Firebase v10 JS SDK (frontend)</text>
  <rect x="68" y="1294" width="196" height="22" rx="11" fill="#dc2626"/>
  <text x="166" y="1309" text-anchor="middle" font-size="9" font-weight="bold" fill="#ffffff">Identity Provider</text>
  <text x="166" y="1366" text-anchor="middle" font-size="8" fill="#dc2626" font-weight="bold">Industry-standard OAuth2</text>

  <!-- Gemini API -->
  <rect x="328" y="1062" width="296" height="316" rx="8" fill="#ecfdf5" stroke="#059669" stroke-width="2"/>
  <rect x="328" y="1062" width="296" height="34" rx="8" fill="#059669"/>
  <rect x="328" y="1084" width="296" height="12" fill="#059669"/>
  <text x="476" y="1084" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">ğŸ¤– Google Gemini API</text>
  <rect x="338" y="1098" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1111" text-anchor="middle" font-size="8" fill="#374151">Protocol: HTTPS REST (Google AI endpoint)</text>
  <rect x="338" y="1122" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1135" text-anchor="middle" font-size="8" fill="#374151">Auth: API Key in X-API-Key header (from .env)</text>
  <rect x="338" y="1146" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1159" text-anchor="middle" font-size="8" fill="#374151">Model: gemini-1.5-flash  Temperature: 0.7</text>
  <rect x="338" y="1170" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1183" text-anchor="middle" font-size="8" fill="#374151">SDK: google.generativeai.GenerativeModel</text>
  <rect x="338" y="1194" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="476" y="1207" text-anchor="middle" font-size="8" fill="#92400e">Returns: text (JSON string, parsed + validated)</text>
  <rect x="338" y="1218" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="476" y="1231" text-anchor="middle" font-size="8" fill="#92400e">Latency: 5â€“10s gen  Â·  8â€“15s eval (LLM-bound)</text>
  <rect x="338" y="1242" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1255" text-anchor="middle" font-size="8" fill="#374151">Retry: 5Ã— exp. backoff + jitter (tenacity)</text>
  <rect x="338" y="1266" width="276" height="18" rx="4" fill="#ffffff" stroke="#a7f3d0" stroke-width="1"/>
  <text x="476" y="1279" text-anchor="middle" font-size="8" fill="#374151">Key never exposed to frontend â€” server only</text>
  <rect x="378" y="1294" width="196" height="22" rx="11" fill="#059669"/>
  <text x="476" y="1309" text-anchor="middle" font-size="9" font-weight="bold" fill="#ffffff">LLM Provider</text>
  <text x="476" y="1366" text-anchor="middle" font-size="8" fill="#059669" font-weight="bold">Quiz Gen Â· Evaluation Â· Summary</text>

  <!-- Firebase Realtime DB -->
  <rect x="638" y="1062" width="296" height="316" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
  <rect x="638" y="1062" width="296" height="34" rx="8" fill="#d97706"/>
  <rect x="638" y="1084" width="296" height="12" fill="#d97706"/>
  <text x="786" y="1084" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">ğŸ”¥ Firebase Realtime DB</text>
  <rect x="648" y="1098" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1111" text-anchor="middle" font-size="8" fill="#374151">Protocol: HTTPS + WebSocket (persistent)</text>
  <rect x="648" y="1122" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1135" text-anchor="middle" font-size="8" fill="#374151">Auth: Service Account JSON (firebase_admin)</text>
  <rect x="648" y="1146" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1159" text-anchor="middle" font-size="8" fill="#374151">SDK: firebase_admin.db.reference(path)</text>
  <rect x="648" y="1170" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1183" text-anchor="middle" font-size="8" fill="#374151">Write: quiz_history/{uid}/{quiz_id} â†’ .set()</text>
  <rect x="648" y="1194" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1207" text-anchor="middle" font-size="8" fill="#92400e">Returns: write ACK / snapshot</text>
  <rect x="648" y="1218" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1231" text-anchor="middle" font-size="8" fill="#92400e">Purpose: Quiz history + user stats persistence</text>
  <rect x="648" y="1242" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1255" text-anchor="middle" font-size="8" fill="#374151">Security Rules: deny all direct client access</text>
  <rect x="648" y="1266" width="276" height="18" rx="4" fill="#ffffff" stroke="#fde68a" stroke-width="1"/>
  <text x="786" y="1279" text-anchor="middle" font-size="8" fill="#374151">Access: backend only via Admin SDK</text>
  <rect x="688" y="1294" width="196" height="22" rx="11" fill="#d97706"/>
  <text x="786" y="1309" text-anchor="middle" font-size="9" font-weight="bold" fill="#ffffff">Cloud Data Store</text>
  <text x="786" y="1366" text-anchor="middle" font-size="8" fill="#d97706" font-weight="bold">Quiz History Â· User Stats</text>

  <!-- ChromaDB -->
  <rect x="948" y="1062" width="296" height="316" rx="8" fill="#fff7ed" stroke="#ea580c" stroke-width="2"/>
  <rect x="948" y="1062" width="296" height="34" rx="8" fill="#ea580c"/>
  <rect x="948" y="1084" width="296" height="12" fill="#ea580c"/>
  <text x="1096" y="1084" text-anchor="middle" font-size="11" font-weight="bold" fill="#ffffff">ğŸ§  ChromaDB</text>
  <rect x="958" y="1098" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1111" text-anchor="middle" font-size="8" fill="#374151">Protocol: In-process Python client (no network)</text>
  <rect x="958" y="1122" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1135" text-anchor="middle" font-size="8" fill="#374151">Auth: None â€” local process, no exposed port</text>
  <rect x="958" y="1146" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1159" text-anchor="middle" font-size="8" fill="#374151">Collection: donor_emails  Metric: cosine</text>
  <rect x="958" y="1170" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1183" text-anchor="middle" font-size="8" fill="#374151">Embedding dim: 384  (MiniLM-L6-v2)</text>
  <rect x="958" y="1194" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="1096" y="1207" text-anchor="middle" font-size="8" fill="#92400e">Returns: { docs, embeddings, distances }</text>
  <rect x="958" y="1218" width="276" height="18" rx="4" fill="#fef9c3" stroke="#fde68a" stroke-width="1"/>
  <text x="1096" y="1231" text-anchor="middle" font-size="8" fill="#92400e">Latency: &lt;50ms (in-memory HNSW index)</text>
  <rect x="958" y="1242" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1255" text-anchor="middle" font-size="8" fill="#374151">Privacy: email content purged after 30 days</text>
  <rect x="958" y="1266" width="276" height="18" rx="4" fill="#ffffff" stroke="#fed7aa" stroke-width="1"/>
  <text x="1096" y="1279" text-anchor="middle" font-size="8" fill="#374151">Embeddings non-reversible â†’ privacy by design</text>
  <rect x="988" y="1294" width="196" height="22" rx="11" fill="#ea580c"/>
  <text x="1096" y="1309" text-anchor="middle" font-size="9" font-weight="bold" fill="#ffffff">Vector Store (Local)</text>
  <text x="1096" y="1366" text-anchor="middle" font-size="8" fill="#ea580c" font-weight="bold">Donor Email Embeddings</text>

  <!-- LEGEND -->
  <rect x="10" y="1392" width="1260" height="56" rx="6" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
  <text x="24" y="1412" font-size="8.5" font-weight="bold" fill="#374151">Arrow Key:</text>
  <line x1="92" y1="1410" x2="128" y2="1410" stroke="#1d4ed8" stroke-width="1.5"/><polygon points="126,1407 134,1410 126,1413" fill="#1d4ed8"/>
  <text x="138" y="1414" font-size="8" fill="#1e40af">Frontend call</text>
  <line x1="220" y1="1410" x2="256" y2="1410" stroke="#059669" stroke-width="1.5"/><polygon points="254,1407 262,1410 254,1413" fill="#059669"/>
  <text x="266" y="1414" font-size="8" fill="#047857">AI call</text>
  <line x1="316" y1="1410" x2="352" y2="1410" stroke="#7c3aed" stroke-width="1.5"/><polygon points="350,1407 358,1410 350,1413" fill="#7c3aed"/>
  <text x="362" y="1414" font-size="8" fill="#6d28d9">DB operation</text>
  <line x1="440" y1="1410" x2="476" y2="1410" stroke="#d97706" stroke-width="1.5"/><polygon points="474,1407 482,1410 474,1413" fill="#d97706"/>
  <text x="486" y="1414" font-size="8" fill="#92400e">External service</text>
  <line x1="582" y1="1410" x2="618" y2="1410" stroke="#374151" stroke-width="1.5" stroke-dasharray="4,3"/><polygon points="616,1407 624,1410 616,1413" fill="#374151"/>
  <text x="628" y="1414" font-size="8" fill="#374151">Return / Response</text>

  <text x="24" y="1436" font-size="8.5" font-weight="bold" fill="#374151">Sections:</text>
  <rect x="92" y="1424" width="110" height="16" rx="8" fill="#dbeafe"/><text x="147" y="1436" text-anchor="middle" font-size="8" fill="#1e40af">5.1 Frontend â†” Backend</text>
  <rect x="210" y="1424" width="110" height="16" rx="8" fill="#ecfdf5"/><text x="265" y="1436" text-anchor="middle" font-size="8" fill="#047857">5.2 Backend â†” AI</text>
  <rect x="328" y="1424" width="130" height="16" rx="8" fill="#f5f3ff"/><text x="393" y="1436" text-anchor="middle" font-size="8" fill="#6d28d9">5.3 Backend â†” Database</text>
  <rect x="466" y="1424" width="130" height="16" rx="8" fill="#fff7ed"/><text x="531" y="1436" text-anchor="middle" font-size="8" fill="#c2410c">5.4 External Services</text>
  <text x="960" y="1436" text-anchor="middle" font-size="8" fill="#9ca3af">QuizBot HLD â€” Module Interaction Diagram  Â·  Sections 5.1 â€“ 5.4</text>
</svg>
